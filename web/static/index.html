<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>strugalem.ru — Сокращение ссылок</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
             background:#0f172a;color:#e2e8f0;min-height:100vh;
             display:flex;flex-direction:column;align-items:center;justify-content:center}
        .container{max-width:560px;width:100%;padding:0 24px;text-align:center}
        h1{font-size:2.5rem;font-weight:700;margin-bottom:8px;color:#f8fafc}
        .subtitle{font-size:1.1rem;color:#94a3b8;margin-bottom:40px}
        .form-group{display:flex;gap:8px;margin-bottom:16px}
        input[type="url"]{flex:1;padding:14px 16px;border:1px solid #334155;border-radius:10px;
             background:#1e293b;color:#f8fafc;font-size:1rem;outline:none;transition:border .2s}
        input[type="url"]:focus{border-color:#6366f1}
        input[type="url"]::placeholder{color:#64748b}
        button{padding:14px 24px;border:none;border-radius:10px;font-size:1rem;
               font-weight:600;cursor:pointer;transition:background .2s}
        .btn-primary{background:#6366f1;color:#fff}
        .btn-primary:hover{background:#4f46e5}
        .btn-primary:disabled{background:#334155;cursor:not-allowed}
        .result{margin-top:24px;padding:20px;background:#1e293b;border:1px solid #334155;
                border-radius:12px;display:none;text-align:left}
        .result.visible{display:block}
        .result-label{font-size:.85rem;color:#94a3b8;margin-bottom:8px}
        .result-row{display:flex;align-items:center;gap:8px}
        .result-link{flex:1;font-size:1.1rem;color:#818cf8;word-break:break-all;
                     text-decoration:none}
        .result-link:hover{text-decoration:underline}
        .btn-copy{background:#334155;color:#e2e8f0;padding:10px 16px;font-size:.9rem;
                  border-radius:8px}
        .btn-copy:hover{background:#475569}
        .error{color:#f87171;font-size:.9rem;margin-top:12px;display:none}
        .error.visible{display:block}
        footer{margin-top:48px;color:#475569;font-size:.85rem}
        footer a{color:#6366f1;text-decoration:none}
        footer a:hover{text-decoration:underline}
    </style>
</head>
<body>
    <div class="container">
        <h1>strugalem.ru</h1>
        <p class="subtitle">Быстрое и простое сокращение ссылок</p>

        <form id="shorten-form">
            <div class="form-group">
                <input type="url" id="url-input" placeholder="Вставьте длинную ссылку" required>
                <button type="submit" class="btn-primary" id="submit-btn">Сократить</button>
            </div>
        </form>

        <div class="error" id="error-msg"></div>

        <div class="result" id="result">
            <div class="result-label">Короткая ссылка</div>
            <div class="result-row">
                <a class="result-link" id="short-link" href="#" target="_blank"></a>
                <button type="button" class="btn-copy" id="copy-btn">Копировать</button>
            </div>
        </div>

        <footer>
            <a href="/swagger/index.html">API Docs</a>
        </footer>
    </div>

    <script>
        const form = document.getElementById('shorten-form');
        const input = document.getElementById('url-input');
        const submitBtn = document.getElementById('submit-btn');
        const resultDiv = document.getElementById('result');
        const shortLink = document.getElementById('short-link');
        const copyBtn = document.getElementById('copy-btn');
        const errorMsg = document.getElementById('error-msg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMsg.classList.remove('visible');
            resultDiv.classList.remove('visible');
            submitBtn.disabled = true;
            submitBtn.textContent = '...';

            try {
                const resp = await fetch('/api/v1/shorten', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({long_url: input.value})
                });
                const data = await resp.json();

                if (!resp.ok) {
                    throw new Error(data.error || 'Ошибка сервера');
                }

                shortLink.href = data.short_url;
                shortLink.textContent = data.short_url;
                resultDiv.classList.add('visible');
                input.value = '';
            } catch (err) {
                errorMsg.textContent = err.message;
                errorMsg.classList.add('visible');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Сократить';
            }
        });

        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(shortLink.href).then(() => {
                copyBtn.textContent = 'Скопировано!';
                setTimeout(() => { copyBtn.textContent = 'Копировать'; }, 1500);
            });
        });
    </script>
</body>
</html>
